<template>
    <lightning-card title="Log Analyzer">
        <div class="slds-p-around_medium">
            <lightning-input
                type="text"
                label="Log Id"
                value={logId}
                onchange={handleLogIdChange}
                placeholder="Ex.: 07L..."
            ></lightning-input>

            <div class="slds-m-top_small">
                <lightning-button
                    label="Analisar"
                    variant="brand"
                    onclick={handleAnalyze}
                    disabled={isAnalyzeDisabled}
                ></lightning-button>
            </div>

            <template lwc:if={loading}>
                <div class="slds-m-top_medium">
                    <lightning-spinner alternative-text="Analisando log" size="medium"></lightning-spinner>
                </div>
            </template>

            <template lwc:if={error}>
                <div class="slds-m-top_medium slds-text-color_error">{error}</div>
            </template>

            <template lwc:if={hasResult}>
                <lightning-card title="Diagnóstico" class="slds-m-top_medium">
                    <div class="slds-p-horizontal_medium slds-p-bottom_medium">
                        <p>{result.rootCause}</p>
                    </div>
                </lightning-card>

                <lightning-card title="Evidências" class="slds-m-top_medium">
                    <div class="slds-p-horizontal_medium slds-p-bottom_medium">
                        <template lwc:if={hasEvidence}>
                            <ul class="slds-list_dotted">
                                <template for:each={evidenceItems} for:item="item">
                                    <li key={item.key}>{item.text}</li>
                                </template>
                            </ul>
                        </template>
                        <template lwc:else>
                            <p>Nenhuma evidência disponível.</p>
                        </template>
                    </div>
                </lightning-card>

                <lightning-card title="Correção" class="slds-m-top_medium">
                    <div class="slds-p-horizontal_medium slds-p-bottom_medium">
                        <template lwc:if={hasFixSteps}>
                            <ul class="slds-list_ordered">
                                <template for:each={fixStepItems} for:item="item">
                                    <li key={item.key}>{item.text}</li>
                                </template>
                            </ul>
                        </template>
                        <template lwc:else>
                            <p>Nenhum passo de correção disponível.</p>
                        </template>
                    </div>
                </lightning-card>

                <lightning-card title="Código" class="slds-m-top_medium">
                    <div class="slds-p-horizontal_medium slds-p-bottom_medium">
                        <template lwc:if={hasCode}>
                            <lightning-textarea value={result.code} readonly></lightning-textarea>
                            <div class="slds-m-top_small">
                                <lightning-button label="Copiar código" onclick={handleCopyCode}></lightning-button>
                            </div>
                        </template>
                        <template lwc:else>
                            <p>Nenhum trecho de código disponível.</p>
                        </template>
                    </div>
                </lightning-card>

                <lightning-card title="Prevenção" class="slds-m-top_medium">
                    <div class="slds-p-horizontal_medium slds-p-bottom_medium">
                        <template lwc:if={hasPrevention}>
                            <ul class="slds-list_dotted">
                                <template for:each={preventionItems} for:item="item">
                                    <li key={item.key}>{item.text}</li>
                                </template>
                            </ul>
                        </template>
                        <template lwc:else>
                            <p>Nenhuma recomendação de prevenção disponível.</p>
                        </template>
                    </div>
                </lightning-card>
            </template>
        </div>
    </lightning-card>
</template>
